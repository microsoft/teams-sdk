---
sidebar_position: 3
title: Federated Identity Credentials
summary: Using Federated Identity Credentials for bot authentication
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Federated Identity Credentials

This authentication mechanism uses [Federated Identity Credentials](https://learn.microsoft.com/en-us/graph/api/resources/federatedidentitycredentials-overview?view=graph-rest-1.0) (FIC for short). With FIC, instead of a User-Managed-Identity being created for you, you are able to assign Managed Identities to the App Registration instead.

<LanguageInclude section="availability-note" />

## Setup Steps

### Create Azure Bot with Single Tenant

When creating your application, you must ensure that you select `Single Tenant` for the `Type of App` when creating your Azure Bot.

![Single Tenant Bot Creation](/screenshots/single-tenant-bot.png)

### Configure Federated Credentials

<Tabs>
<TabItem value="portal" label="Azure Portal">

In your App Registration, go to `Certificates and Secrets` and navigate to the `Federated Credentials` tab. Here, you can assign User-Managed-Identities or System Assigned Identities which you want to allow using your App Registration.

![Federated Identity Creds](/screenshots/fic.png)

The identity you select here must also be assigned to the VM or compute resource where your application is hosted.

</TabItem>
<TabItem value="cli" label="Azure CLI">

```bash
# Add a federated credential for a user managed identity
az ad app federated-credential create \
  --id $APP_ID \
  --parameters '{
    "name": "MyFederatedCredential",
    "issuer": "https://login.microsoftonline.com/'$TENANT_ID'/v2.0",
    "subject": "'$MANAGED_IDENTITY_CLIENT_ID'",
    "audiences": ["api://AzureADTokenExchange"]
  }'
```

</TabItem>
</Tabs>

### Assign the Managed Identity

Assign the managed identity to your compute resource (App Service, Container App, VM, etc.).

<Tabs>
<TabItem value="portal" label="Azure Portal">

1. Navigate to your compute resource
2. Go to `Identity` section
3. Assign the corresponding managed identity (User Assigned or System Assigned)

</TabItem>
<TabItem value="cli" label="Azure CLI">

```bash
# For user managed identity:
az webapp identity assign \
  --name $APP_NAME \
  --resource-group $RESOURCE_GROUP \
  --identities $MANAGED_IDENTITY_RESOURCE_ID

# For system assigned identity:
az webapp identity assign \
  --name $APP_NAME \
  --resource-group $RESOURCE_GROUP
```

</TabItem>
</Tabs>

### Configure Your Application

Depending on the type of managed identity you select, you need to set the environment variables accordingly.

## Configuration

**For User-Managed-Identity:**

Set the following environment variables:
- `CLIENT_ID`: Your Application (client) ID
- `MANAGED_IDENTITY_CLIENT_ID`: The Client ID for the User-Managed-Identity resource
- **Do not set** `CLIENT_SECRET`

```env
CLIENT_ID=your-app-client-id-here
MANAGED_IDENTITY_CLIENT_ID=your-managed-identity-client-id-here
# Do not set CLIENT_SECRET
```

**For System Assigned Identity:**

Set the following environment variables:
- `CLIENT_ID`: Your Application (client) ID
- `MANAGED_IDENTITY_CLIENT_ID`: `system`
- **Do not set** `CLIENT_SECRET`

```env
CLIENT_ID=your-app-client-id-here
MANAGED_IDENTITY_CLIENT_ID=system
# Do not set CLIENT_SECRET
```
